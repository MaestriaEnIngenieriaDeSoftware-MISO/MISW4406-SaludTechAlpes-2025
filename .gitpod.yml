# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/config-gitpod-file)
# and commit this file to your remote git repository to share the goodness with others.

tasks:
  - name: Instalar Python
    init: > 
      pyenv install 3.10.7 -f &&
      pyenv local 3.10.7 &&
      gp sync-done bundle
  - name: Instalar dependencias
    init: gp sync-await bundle
    command: pip install -r requirements.txt && pip install -r exportacionsta-requirements.txt && pip install -r bff-requirements.txt
  - name: Crear imagenes Docker
    init: >
      docker build . -f exportacionsta.Dockerfile -t exportacionsta/flask &&
      docker build . -f saludtechalpes.Dockerfile -t saludtechalpes/flask &&
      docker build . -f bff.Dockerfile -t bff_sta/flask &&
      gp sync-done images
  - name: Pull el Docker compose
    init: gp sync-await images
    command: docker-compose pull
  - name: üõ†Ô∏è Init workspace
    init: |
      echo 'üí´ GCP configuration'
      echo $GCP_SERVICE_KEY | base64 -d > .gcloud-conf.json

      echo 'üå§Ô∏è Install gcloud'
      cd ..
      curl -O https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-cli-394.0.0-linux-x86_64.tar.gz
      tar -xf google-cloud-cli-394.0.0-linux-x86_64.tar.gz
      ./google-cloud-sdk/install.sh
      cd ${GITPOD_REPO_ROOTS}

      echo 'üí´ Create Alias: `gcloud`'
      alias gcloud=/workspace/google-cloud-sdk/bin/gcloud
      source ~/.bashrc

      echo 'üå§Ô∏è Configure gcloud with your key and projects you have to set in your Gitpod account : https://gitpod.io/user/variables'
      gcloud auth activate-service-account --key-file .gcloud-conf.json
      gcloud config set project $GCP_PROJECT

      echo '‚ò∏Ô∏è Configure k8s'
      gcloud components install gke-gcloud-auth-plugin --quiet
      gcloud components install kubectl --quiet
  


